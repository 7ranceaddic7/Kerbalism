//RIP adaptive container switcher, rip SSTU deploy module/animation, add Kerbalism deploy mechanism.
//no counterweight animation because i have no clue how to hook in a 2nd animation for kerbalism's rotation.
//to-do: calculate proper volumes for each.

//=====================================================================================================================================================================
//have to add crew capacity before doing anything else  to let kerbalism do its shenenigans

@PART[SSTU-ST-CFG-*]:NEEDS[Kerbalism,SSTU]
{	
	@CrewCapacity = #$MODULE[SSTUInflatable]/inflatedCrew$
	!MODULE[SSTUVolumeContainer] {}	
}

//=====================================================================================================================================================================
//kerbalism handles inflate and rotate animations through its own module. adjusting as required.

@PART[SSTU-ST-CFG-*]:NEEDS[SSTU,FeatureComfort]:AFTER[Kerbalism]
{
	@MODULE[Habitat]
		{															
			%state = disabled
			%inflatableUsingRigidWalls = False
		}

	MODULE
		{
			name = GravityRing
			ec_rate = 2.5
			animBackwards = False
			deploy = #$../MODULE[SSTUInflatable]/ANIMATIONDATA/ANIMATION/name$
			rotate = #$../MODULE[SSTUAnimateRotation]/transformName$
			deployed = False
			rotateIsTransform = True
		}
	
	!MODULE[SSTUInflatable] {}
	!MODULE[SSTUAnimateRotation] {}
// add treadmills to centrifuges because it makes sense.
	MODULE:NEEDS[FeatureComfort]
		{
			name = Comfort
			desc = This centrifuge has included a rotation system that simulates gravity. The crew will benefit from it by allowing them to excercise.
			bonus = exercise
		}

	MODULE:NEEDS[FeatureReliability]
		{
			name = Reliability
			type = Comfort
			title = Treadmill
			repair = Engineer
			mtbf = 36288000
			extra_cost = 0.25
			extra_mass = 0.05
		}
}


//=====================================================================================================================================================================
//individual volume settings/calculations, adds back the resources lost when removing SSTUVolumeContainer

@PART[SSTU-ST-CFG-A]:NEEDS[SSTU,FeatureComfort]:AFTER[Kerbalism]
{
	@MODULE[Habitat]
		{
			%volume = 115.66							//1.25r, 3.75R (2.5m diameter tube, with outer torus diameter of 10m)
														//Volume of a torus (donut in plain english). (pir^2)(2piR). plenty of calculators online. R=major, r=minor radii.
														//yes, for complete accuracy, i'd have to account for the center core+ the tubes connecting the core to the torus
														//for now, it's close enough for the purpose.
			%surface = 	185.06							//same as above, calculating the area of the torus only.	(2piR)(2pir)
		}
		
	RESOURCE
		{
			name = ElectricCharge
			amount = 80
			@amount /= 2.8								//kerbalism globally multiplies EC by 2.8 for all parts. Compensating.
			maxAmount = 80
			@maxAmount /= 2.8
		}
}

@PART[SSTU-ST-CFG-B]:NEEDS[SSTU,FeatureComfort]:AFTER[Kerbalism]
{
	@MODULE[Habitat]
		{	
			%volume = 563.84							//1.875r, 8.125R (3.75m tube, 20m outer torus diameter)
			%surface = 400.95
		}
		
	RESOURCE
		{
			name = ElectricCharge
			amount = 160
			@amount /= 2.8								
			maxAmount = 160
			@maxAmount /= 2.8
		}	
}

@PART[SSTU-ST-CFG-C]:NEEDS[SSTU,FeatureComfort]:AFTER[Kerbalism]
{
	@MODULE[Habitat]
		{
			%volume = 1084.31							//1.875r, 15.625R (3.75m tube, 35m outer torus diameter)
			%surface = 1156.59
		}
	
	RESOURCE
		{
			name = ElectricCharge
			amount = 320
			@amount /= 2.8								
			maxAmount = 320
			@maxAmount /= 2.8
		}
}

@PART[SSTU-ST-CFG-D]:NEEDS[SSTU,FeatureComfort]:AFTER[Kerbalism]
{
	@MODULE[Habitat]
		{
			%volume = 2775.83							//2.5r, 22.5R (5m tube, 50m outer torus diameter)	
			%surface = 2220.66							//have fun bleeding nitrogen.
		}

	RESOURCE
		{
			name = ElectricCharge
			amount = 640
			@amount /= 2.8								
			maxAmount = 640
			@maxAmount /= 2.8
		}
}

