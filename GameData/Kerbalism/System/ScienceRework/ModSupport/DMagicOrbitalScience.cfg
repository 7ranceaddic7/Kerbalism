DMOS_EXPERIMENT_VALUES:NEEDS[DMagicOrbitalScience,FeatureScience]
{
	MagnetometerScan
	{
		ECCost = 0.18							
		size = 9452
		value = 5								
		duration = 648000						//30 days
		requirements = Magnetosphere
		ResourceRates =
		SetupMass = 0.015
		SetupCost = 1000
		UnlockTech = engineering101
	}
	
	RPWS
	{
		ECCost = 0.24							
		size = 4583
		value = 9								
		duration = 2592000						// 120 days
		requirements = Space
		ResourceRates =
		SetupMass = 0.015
		SetupCost = 4500
		UnlockTech = electrics
	}
	
	OrbitalTelescope
	{
		ECCost = 0.04							
		size = 98523
		value = 6								
		duration = 151200						// 7 days
		requirements = Space
		ResourceRates =
		SetupMass = 0.03
		SetupCost = 4000
		UnlockTech = basicScience
	}
	
	MultiSpectralAnalysis
	{
		ECCost = 0.48							
		size = 8425
		value = 8								
		duration = 972000						// 45 days
		requirements = Space
		ResourceRates =
		SetupMass = 0.02
		SetupCost = 5000
		UnlockTech = advExploration
	}
	
	SIGINT
	{
		ECCost = 0.88							
		size = 12584
		value = 25								
		duration = 3024000						// 140 days
		requirements = Space
		ResourceRates =
		SetupMass = 1
		SetupCost = 7000
		UnlockTech = miniaturization
		LargeVariantMultiplier = 2				// DMOS has 2 parts with the same experiment. one small one big. to differentiate, the data rate AND ec cost are multiplied by this number.
	}
	
	RECON
	{
		ECCost = 2.84							
		size = 85486
		value = 40								
		duration = 3888000						// 180 days
		requirements = Space
		ResourceRates =
		SetupMass = 1
		SetupCost = 7500
		UnlockTech = spaceExploration
		LargeVariantMultiplier = 2				// DMOS has 2 parts with the same experiment. one small one big. to differentiate, the data rate AND ec cost are multiplied by this number.
	}
	
	ALBEDO
	{
		ECCost = 14.92							
		size = 6852
		value = 6								
		duration = 150							// 2 min 30. it's a surface sample.
		requirements = Surface
		ResourceRates =
		SampleMass = 0.005
		SetupMass = 
		SetupCost = 
		UnlockTech =
	}
	
	XRAYDIFFRACT
	{
		ECCost = 19.25							
		size = 8423
		value = 10								
		duration = 450							// 7.5 min. surface sample v2.0
		requirements = Surface
		ResourceRates =
		SampleMass = 0.008
		SetupMass = 
		SetupCost = 
		UnlockTech =
	}
	
	LASERBLAST
	{
		ECCost = 24.85							
		size = 14844
		value = 6								
		duration = 600							// 10 min. Surface Sample v3.0
		requirements = Surface
		ResourceRates =
		SampleMass = 0.012
		SetupMass = 
		SetupCost = 
		UnlockTech =
	}
	
	SOLARPARTICLES
	{
		ECCost = 2.84							
		size = 25843
		value = 8								
		duration = 6480000						// 300 days
		requirements = InterPlanetary
		ResourceRates =
		SetupMass = advConstruction
		SetupCost = 6000
		UnlockTech = 0.02
	}
	
	SoilMoisture
	{
		ECCost = 1.54							
		size = 3574
		value = 12								
		duration = 1944000						// 90 days
		requirements = Space
		ResourceRates =
		SetupMass = 0.04
		SetupCost = 4500
		UnlockTech = largeElectrics
	}
	
	AsteroidScan
	{
		ECCost = 5.73							
		size = 1524
		value = 8								
		duration = 86400						// 4 days
		requirements = MaxAsteroidDistance:2500,InterPlanetary
		ResourceRates =
		SetupMass = 0.02
		SetupCost = 6500
		UnlockTech = actuators
	}
	
	GORESAT
	{
		ECCost = 3.22							
		size = 2584
		value = 12								
		duration = 453600						// 21 days
		requirements = Space
		ResourceRates =
		SetupMass = 0.02
		SetupCost = 4000
		UnlockTech = precisionEngineering
	}
	
	SeismicHammer
	{
		ECCost = 1.22							
		size = 3589
		value = 20								
		duration = 648000						// 30 days
		requirements = Surface
		ResourceRates =
		SetupMass = 
		SetupCost = 
		UnlockTech =
	}
	
	Bathymetry
	{
		ECCost = 6.85							
		size = 873
		value = 16								
		duration = 900							// 15 min. 
		requirements = Ocean,AltitudeMax:-50
		ResourceRates =
		SampleMass = 0.002
		SetupMass = 
		SetupCost = 
		UnlockTech =
	}
	
	BioDrill
	{
		ECCost = 15.27							
		size = 3285
		value = 6								
		duration = 420							// AYYYY. 7 min. Surface Sample 4.0.
		requirements = Surface
		ResourceRates =
		SampleMass = 0.01
		SetupMass = 
		SetupCost = 
		UnlockTech =
	}
	
	AnomalyScan
	{
		ECCost = 4.37							
		size = 365
		value = 2								// nuked value due to biomes (changed the experiment, can't reproduce functionality)								
		duration = 302400						// 14 days PER BIOME. it'll take a while.
		requirements = Space,OrbitMaxEccentricity:0.01,OrbitMinInclination:89.5,OrbitMaxInclination:90.5
		ResourceRates =
		SetupMass = 0.015
		SetupCost = 12000
		UnlockTech = advScienceTech
	}
	
	MISC
	{
		MicroGoo									// because this is smaller that stock part, it'll be slower and hold less samples than stock once upgraded.
		{
			SampleReservoirUpgrade = 3				// total sample reservoir (not a multiplier. a value of 3 means it'll be able to run 3 times.
			durationMultiplier = 2					// Multiplier. 2 means it'll be 2 times longer.
		}
		
		MicroMatBay
		{
			SampleReservoirUpgrade = 2				// similar as above (MicroGoo)
			durationMultiplier = 3	
		}
	}
}

// =========================================================
// Bye seismic pod. 
// 1: annoying. 
// 2: can't reproduce functionality.
// The hammer itself will have to do.
// =========================================================

-PART[dmSeismicPod]:NEEDS[DMagicOrbitalScience,FeatureScience]	{}

// =========================================================
// Replaces DMagic's experiment modules with kerbalism's.
// Fixes animations in the process.
// Looks funny because of parts with more than one experiment
// Credit to blowfish for figuring this one out.
// =========================================================

@PART[rpwsAnt,dm*]:HAS[@MODULE[DM*]:HAS[#experimentID]]:NEEDS[DMagicOrbitalScience,FeatureScience]
{
    @MODULE:HAS[#experimentID,~name[Experiment]]
    {
        migratedExperiment = false
    }
	!MODULE[DMEnviroSensor],*	{}	
}
@PART[rpwsAnt,dm*]:HAS[@MODULE[DM*]:HAS[#experimentID,#migratedExperiment[false]]]:NEEDS[DMagicOrbitalScience,FeatureScience]
{
    MM_PATCH_LOOP {}
    MODULE
    {
        name = Experiment
		*/MODULE:HAS[#experimentID,~name[Experiment],#migratedExperiment[false]]/migratedExperiment = true
        experiment_id = #$/MODULE:HAS[#experimentID,~name[Experiment],#migratedExperiment[true]]/experimentID$
		anim_deploy = #$/MODULE:HAS[#experimentID,~name[Experiment],#migratedExperiment[true]]/animationName$
        
    }
    !MODULE:HAS[#experimentID,~name[Experiment],#migratedExperiment[true]] {}
}

// =========================================================
// Patching the experiment parameters based on the values from DMOS_EXPERIMENT_VALUES
// =========================================================

@PART[*]:HAS[@MODULE[Experiment]]:NEEDS[DMagicOrbitalScience,FeatureScience]:AFTER[Kerbalism]
{
	@MODULE[Experiment]:HAS[#experiment_id[magScan]]
	{
		%ec_rate = #$@DMOS_EXPERIMENT_VALUES/MagnetometerScan/ECCost$
		%requires = #$@DMOS_EXPERIMENT_VALUES/MagnetometerScan/requirements$
		%data_rate = #$@DMOS_EXPERIMENT_VALUES/MagnetometerScan/size$
		@data_rate /= #$@DMOS_EXPERIMENT_VALUES/MagnetometerScan/duration$
		%resources = #$@DMOS_EXPERIMENT_VALUES/MagnetometerScan/ResourceRates$
		%allow_shrouded = False
	}
	
	@MODULE[Experiment]:HAS[#experiment_id[rpwsScan]]
	{
		%ec_rate = #$@DMOS_EXPERIMENT_VALUES/RPWS/ECCost$
		%requires = #$@DMOS_EXPERIMENT_VALUES/RPWS/requirements$
		%data_rate = #$@DMOS_EXPERIMENT_VALUES/RPWS/size$
		@data_rate /= #$@DMOS_EXPERIMENT_VALUES/RPWS/duration$
		%resources = #$@DMOS_EXPERIMENT_VALUES/RPWS/ResourceRates$
		%allow_shrouded = False
	}
	
	@MODULE[Experiment]:HAS[#experiment_id[scopeScan]]
	{
		%ec_rate = #$@DMOS_EXPERIMENT_VALUES/OrbitalTelescope/ECCost$
		%requires = #$@DMOS_EXPERIMENT_VALUES/OrbitalTelescope/requirements$
		%data_rate = #$@DMOS_EXPERIMENT_VALUES/OrbitalTelescope/size$
		@data_rate /= #$@DMOS_EXPERIMENT_VALUES/OrbitalTelescope/duration$
		%resources = #$@DMOS_EXPERIMENT_VALUES/OrbitalTelescope/ResourceRates$
		%allow_shrouded = False
	}
	
	@MODULE[Experiment]:HAS[#experiment_id[dmImagingPlatform]]
	{
		%ec_rate = #$@DMOS_EXPERIMENT_VALUES/MultiSpectralAnalysis/ECCost$
		%requires = #$@DMOS_EXPERIMENT_VALUES/MultiSpectralAnalysis/requirements$
		%data_rate = #$@DMOS_EXPERIMENT_VALUES/MultiSpectralAnalysis/size$
		@data_rate /= #$@DMOS_EXPERIMENT_VALUES/MultiSpectralAnalysis/duration$
		%resources = #$@DMOS_EXPERIMENT_VALUES/MultiSpectralAnalysis/ResourceRates$
		%allow_shrouded = False
	}
	
	@MODULE[Experiment]:HAS[#experiment_id[dmSIGINT]]
	{
		%ec_rate = #$@DMOS_EXPERIMENT_VALUES/SIGINT/ECCost$
		%requires = #$@DMOS_EXPERIMENT_VALUES/SIGINT/requirements$
		%data_rate = #$@DMOS_EXPERIMENT_VALUES/SIGINT/size$
		@data_rate /= #$@DMOS_EXPERIMENT_VALUES/SIGINT/duration$
		%resources = #$@DMOS_EXPERIMENT_VALUES/SIGINT/ResourceRates$
		%allow_shrouded = False
	}
	
	@MODULE[Experiment]:HAS[#experiment_id[dmReconScan]]
	{
		%ec_rate = #$@DMOS_EXPERIMENT_VALUES/RECON/ECCost$
		%requires = #$@DMOS_EXPERIMENT_VALUES/RECON/requirements$
		%data_rate = #$@DMOS_EXPERIMENT_VALUES/RECON/size$
		@data_rate /= #$@DMOS_EXPERIMENT_VALUES/RECON/duration$
		%resources = #$@DMOS_EXPERIMENT_VALUES/RECON/ResourceRates$
		%allow_shrouded = False
	}
	
	@MODULE[Experiment]:HAS[#experiment_id[dmNAlbedoScan]]
	{
		%ec_rate = #$@DMOS_EXPERIMENT_VALUES/ALBEDO/ECCost$
		%requires = #$@DMOS_EXPERIMENT_VALUES/ALBEDO/requirements$
		%data_rate = #$@DMOS_EXPERIMENT_VALUES/ALBEDO/size$
		@data_rate /= #$@DMOS_EXPERIMENT_VALUES/ALBEDO/duration$
		%resources = #$@DMOS_EXPERIMENT_VALUES/ALBEDO/ResourceRates$
		%sample_mass = #$@DMOS_EXPERIMENT_VALUES/ALBEDO/SampleMass$
		%sample_collecting = True
		%sample_reservoir = 0
		%allow_shrouded = False	
	}
	
	@MODULE[Experiment]:HAS[#experiment_id[dmXRayDiffract]]
	{
		%ec_rate = #$@DMOS_EXPERIMENT_VALUES/XRAYDIFFRACT/ECCost$
		%requires = #$@DMOS_EXPERIMENT_VALUES/XRAYDIFFRACT/requirements$
		%data_rate = #$@DMOS_EXPERIMENT_VALUES/XRAYDIFFRACT/size$
		@data_rate /= #$@DMOS_EXPERIMENT_VALUES/XRAYDIFFRACT/duration$
		%resources = #$@DMOS_EXPERIMENT_VALUES/XRAYDIFFRACT/ResourceRates$
		%sample_mass = #$@DMOS_EXPERIMENT_VALUES/XRAYDIFFRACT/SampleMass$
		%sample_collecting = True
		%sample_reservoir = 0
		%allow_shrouded = False	
	}
	
	@MODULE[Experiment]:HAS[#experiment_id[dmlaserblastscan]]
	{
		%ec_rate = #$@DMOS_EXPERIMENT_VALUES/LASERBLAST/ECCost$
		%requires = #$@DMOS_EXPERIMENT_VALUES/LASERBLAST/requirements$
		%data_rate = #$@DMOS_EXPERIMENT_VALUES/LASERBLAST/size$
		@data_rate /= #$@DMOS_EXPERIMENT_VALUES/LASERBLAST/duration$
		%resources = #$@DMOS_EXPERIMENT_VALUES/LASERBLAST/ResourceRates$
		%sample_mass = #$@DMOS_EXPERIMENT_VALUES/LASERBLAST/SampleMass$
		%sample_collecting = True
		%sample_reservoir = 0
		%allow_shrouded = False		
	}
	
	@MODULE[Experiment]:HAS[#experiment_id[dmSolarParticles]]
	{
		%ec_rate = #$@DMOS_EXPERIMENT_VALUES/SOLARPARTICLES/ECCost$
		%requires = #$@DMOS_EXPERIMENT_VALUES/SOLARPARTICLES/requirements$
		%data_rate = #$@DMOS_EXPERIMENT_VALUES/SOLARPARTICLES/size$
		@data_rate /= #$@DMOS_EXPERIMENT_VALUES/SOLARPARTICLES/duration$
		%resources = #$@DMOS_EXPERIMENT_VALUES/SOLARPARTICLES/ResourceRates$
		%allow_shrouded = False
	}
	
	@MODULE[Experiment]:HAS[#experiment_id[dmSoilMoisture]]
	{
		%ec_rate = #$@DMOS_EXPERIMENT_VALUES/SoilMoisture/ECCost$
		%requires = #$@DMOS_EXPERIMENT_VALUES/SoilMoisture/requirements$
		%data_rate = #$@DMOS_EXPERIMENT_VALUES/SoilMoisture/size$
		@data_rate /= #$@DMOS_EXPERIMENT_VALUES/SoilMoisture/duration$
		%resources = #$@DMOS_EXPERIMENT_VALUES/SoilMoisture/ResourceRates$
		%allow_shrouded = False
	}
	
	@MODULE[Experiment]:HAS[#experiment_id[dmAsteroidScan]]
	{
		%ec_rate = #$@DMOS_EXPERIMENT_VALUES/AsteroidScan/ECCost$
		%requires = #$@DMOS_EXPERIMENT_VALUES/AsteroidScan/requirements$
		%data_rate = #$@DMOS_EXPERIMENT_VALUES/AsteroidScan/size$
		@data_rate /= #$@DMOS_EXPERIMENT_VALUES/AsteroidScan/duration$
		%resources = #$@DMOS_EXPERIMENT_VALUES/AsteroidScan/ResourceRates$
		%allow_shrouded = False
	}
	
	@MODULE[Experiment]:HAS[#experiment_id[dmRadiometerScan]]
	{
		%ec_rate = #$@DMOS_EXPERIMENT_VALUES/GORESAT/ECCost$
		%requires = #$@DMOS_EXPERIMENT_VALUES/GORESAT/requirements$
		%data_rate = #$@DMOS_EXPERIMENT_VALUES/GORESAT/size$
		@data_rate /= #$@DMOS_EXPERIMENT_VALUES/GORESAT/duration$
		%resources = #$@DMOS_EXPERIMENT_VALUES/GORESAT/ResourceRates$
		%allow_shrouded = False
	}
	
	@MODULE[Experiment]:HAS[#experiment_id[dmseismicHammer]]
	{
		%ec_rate = #$@DMOS_EXPERIMENT_VALUES/SeismicHammer/ECCost$
		%requires = #$@DMOS_EXPERIMENT_VALUES/SeismicHammer/requirements$
		%data_rate = #$@DMOS_EXPERIMENT_VALUES/SeismicHammer/size$
		@data_rate /= #$@DMOS_EXPERIMENT_VALUES/SeismicHammer/duration$
		%resources = #$@DMOS_EXPERIMENT_VALUES/SeismicHammer/ResourceRates$
		%allow_shrouded = False
	}
	
	@MODULE[Experiment]:HAS[#experiment_id[dmbathymetryscan]]
	{
		%ec_rate = #$@DMOS_EXPERIMENT_VALUES/Bathymetry/ECCost$
		%requires = #$@DMOS_EXPERIMENT_VALUES/Bathymetry/requirements$
		%data_rate = #$@DMOS_EXPERIMENT_VALUES/Bathymetry/size$
		@data_rate /= #$@DMOS_EXPERIMENT_VALUES/Bathymetry/duration$
		%resources = #$@DMOS_EXPERIMENT_VALUES/Bathymetry/ResourceRates$
		%sample_mass = #$@DMOS_EXPERIMENT_VALUES/Bathymetry/SampleMass$
		%sample_collecting = True
		%sample_reservoir = 0
		%allow_shrouded = False
	}
	
	@MODULE[Experiment]:HAS[#experiment_id[dmbiodrillscan]]
	{
		%ec_rate = #$@DMOS_EXPERIMENT_VALUES/BioDrill/ECCost$
		%requires = #$@DMOS_EXPERIMENT_VALUES/BioDrill/requirements$
		%data_rate = #$@DMOS_EXPERIMENT_VALUES/BioDrill/size$
		@data_rate /= #$@DMOS_EXPERIMENT_VALUES/BioDrill/duration$
		%resources = #$@DMOS_EXPERIMENT_VALUES/BioDrill/ResourceRates$
		%sample_mass = #$@DMOS_EXPERIMENT_VALUES/BioDrill/SampleMass$
		%sample_collecting = True
		%sample_reservoir = 0
		%allow_shrouded = False
	}
	
	@MODULE[Experiment]:HAS[#experiment_id[AnomalyScan]]
	{
		%ec_rate = #$@DMOS_EXPERIMENT_VALUES/AnomalyScan/ECCost$
		%requires = #$@DMOS_EXPERIMENT_VALUES/AnomalyScan/requirements$
		%data_rate = #$@DMOS_EXPERIMENT_VALUES/AnomalyScan/size$
		@data_rate /= #$@DMOS_EXPERIMENT_VALUES/AnomalyScan/duration$
		%resources = #$@DMOS_EXPERIMENT_VALUES/AnomalyScan/ResourceRates$
		%allow_shrouded = False
	}
}

// =========================================================
// Pathing the definitions, replacing value and size with the ones specified above.
// =========================================================
@EXPERIMENT_DEFINITION:HAS[#id[magScan]]:NEEDS[DMagicOrbitalScience,FeatureScience]:AFTER[Kerbalism]
{
	@baseValue = #$@DMOS_EXPERIMENT_VALUES/MagnetometerScan/value$
	@dataScale = #$@DMOS_EXPERIMENT_VALUES/MagnetometerScan/size$
	@dataScale /= #$baseValue$
	@situationMask = 48
	@biomeMask = 0
}

@EXPERIMENT_DEFINITION:HAS[#id[rpwsScan]]:NEEDS[DMagicOrbitalScience,FeatureScience]:AFTER[Kerbalism]
{
	@baseValue = #$@DMOS_EXPERIMENT_VALUES/RPWS/value$
	@dataScale = #$@DMOS_EXPERIMENT_VALUES/RPWS/size$
	@dataScale /= #$baseValue$
}

@EXPERIMENT_DEFINITION:HAS[#id[scopeScan]]:NEEDS[DMagicOrbitalScience,FeatureScience]:AFTER[Kerbalism]
{
	@baseValue = #$@DMOS_EXPERIMENT_VALUES/OrbitalTelescope/value$
	@dataScale = #$@DMOS_EXPERIMENT_VALUES/OrbitalTelescope/size$
	@dataScale /= #$baseValue$
}

@EXPERIMENT_DEFINITION:HAS[#id[dmImagingPlatform]]:NEEDS[DMagicOrbitalScience,FeatureScience]:AFTER[Kerbalism]
{
	@baseValue = #$@DMOS_EXPERIMENT_VALUES/MultiSpectralAnalysis/value$
	@dataScale = #$@DMOS_EXPERIMENT_VALUES/MultiSpectralAnalysis/size$
	@dataScale /= #$baseValue$
}

@EXPERIMENT_DEFINITION:HAS[#id[dmSIGINT]]:NEEDS[DMagicOrbitalScience,FeatureScience]:AFTER[Kerbalism]
{
	@baseValue = #$@DMOS_EXPERIMENT_VALUES/SIGINT/value$
	@dataScale = #$@DMOS_EXPERIMENT_VALUES/SIGINT/size$
	@dataScale /= #$baseValue$
}

@EXPERIMENT_DEFINITION:HAS[#id[dmReconScan]]:NEEDS[DMagicOrbitalScience,FeatureScience]:AFTER[Kerbalism]
{
	@baseValue = #$@DMOS_EXPERIMENT_VALUES/RECON/value$
	@dataScale = #$@DMOS_EXPERIMENT_VALUES/RECON/size$
	@dataScale /= #$baseValue$
}

@EXPERIMENT_DEFINITION:HAS[#id[dmNAlbedoScan]]:NEEDS[DMagicOrbitalScience,FeatureScience]:AFTER[Kerbalism]
{
	@baseValue = #$@DMOS_EXPERIMENT_VALUES/ALBEDO/value$
	@dataScale = #$@DMOS_EXPERIMENT_VALUES/ALBEDO/size$
	@dataScale /= #$baseValue$
}

@EXPERIMENT_DEFINITION:HAS[#id[dmXRayDiffract]]:NEEDS[DMagicOrbitalScience,FeatureScience]:AFTER[Kerbalism]
{
	@baseValue = #$@DMOS_EXPERIMENT_VALUES/XRAYDIFFRACT/value$
	@dataScale = #$@DMOS_EXPERIMENT_VALUES/XRAYDIFFRACT/size$
	@dataScale /= #$baseValue$
}

@EXPERIMENT_DEFINITION:HAS[#id[dmlaserblastscan]]:NEEDS[DMagicOrbitalScience,FeatureScience]:AFTER[Kerbalism]
{
	@baseValue = #$@DMOS_EXPERIMENT_VALUES/LASERBLAST/value$
	@dataScale = #$@DMOS_EXPERIMENT_VALUES/LASERBLAST/size$
	@dataScale /= #$baseValue$
}

@EXPERIMENT_DEFINITION:HAS[#id[dmSolarParticles]]:NEEDS[DMagicOrbitalScience,FeatureScience]:AFTER[Kerbalism]
{
	@baseValue = #$@DMOS_EXPERIMENT_VALUES/SOLARPARTICLES/value$
	@dataScale = #$@DMOS_EXPERIMENT_VALUES/SOLARPARTICLES/size$
	@dataScale /= #$baseValue$
}

@EXPERIMENT_DEFINITION:HAS[#id[dmSoilMoisture]]:NEEDS[DMagicOrbitalScience,FeatureScience]:AFTER[Kerbalism]
{
	@baseValue = #$@DMOS_EXPERIMENT_VALUES/SoilMoisture/value$
	@dataScale = #$@DMOS_EXPERIMENT_VALUES/SoilMoisture/size$
	@dataScale /= #$baseValue$
}

@EXPERIMENT_DEFINITION:HAS[#id[dmAsteroidScan]]:NEEDS[DMagicOrbitalScience,FeatureScience]:AFTER[Kerbalism]
{
	@baseValue = #$@DMOS_EXPERIMENT_VALUES/AsteroidScan/value$
	@dataScale = #$@DMOS_EXPERIMENT_VALUES/AsteroidScan/size$
	@dataScale /= #$baseValue$
	@situationMask = 48
}

@EXPERIMENT_DEFINITION:HAS[#id[dmRadiometerScan]]:NEEDS[DMagicOrbitalScience,FeatureScience]:AFTER[Kerbalism]
{
	@baseValue = #$@DMOS_EXPERIMENT_VALUES/GORESAT/value$
	@dataScale = #$@DMOS_EXPERIMENT_VALUES/GORESAT/size$
	@dataScale /= #$baseValue$
}

@EXPERIMENT_DEFINITION:HAS[#id[dmseismicHammer]]:NEEDS[DMagicOrbitalScience,FeatureScience]:AFTER[Kerbalism]
{
	@baseValue = #$@DMOS_EXPERIMENT_VALUES/SeismicHammer/value$
	@dataScale = #$@DMOS_EXPERIMENT_VALUES/SeismicHammer/size$
	@dataScale /= #$baseValue$
}

@EXPERIMENT_DEFINITION:HAS[#id[dmbathymetryscan]]:NEEDS[DMagicOrbitalScience,FeatureScience]:AFTER[Kerbalism]
{
	@baseValue = #$@DMOS_EXPERIMENT_VALUES/Bathymetry/value$
	@dataScale = #$@DMOS_EXPERIMENT_VALUES/Bathymetry/size$
	@dataScale /= #$baseValue$
}

@EXPERIMENT_DEFINITION:HAS[#id[dmbiodrillscan]]:NEEDS[DMagicOrbitalScience,FeatureScience]:AFTER[Kerbalism]
{
	@baseValue = #$@DMOS_EXPERIMENT_VALUES/BioDrill/value$
	@dataScale = #$@DMOS_EXPERIMENT_VALUES/BioDrill/size$
	@dataScale /= #$baseValue$
}

@EXPERIMENT_DEFINITION:HAS[#id[AnomalyScan]]:NEEDS[DMagicOrbitalScience,FeatureScience]:AFTER[Kerbalism]
{
	@baseValue = #$@DMOS_EXPERIMENT_VALUES/AnomalyScan/value$
	@dataScale = #$@DMOS_EXPERIMENT_VALUES/AnomalyScan/size$
	@dataScale /= #$baseValue$
	@situationMask = 16
	@biomeMask = 16
}

// =========================================================
// Individual part tweaks
// =========================================================

@PART[dmReconLarge]:NEEDS[DMagicOrbitalScience,FeatureScience]:AFTER[Kerbalism]
{
	@MODULE[Experiment]:HAS[#experiment_id[dmReconScan]]
	{
		@data_rate *= #$@DMOS_EXPERIMENT_VALUES/RECON/LargeVariantMultiplier$
		@ec_rate *= #$@DMOS_EXPERIMENT_VALUES/RECON/LargeVariantMultiplier$
	}
}

@PART[dmSIGINT?End]:NEEDS[DMagicOrbitalScience,FeatureScience]:AFTER[Kerbalism]
{
	@MODULE[Experiment]:HAS[#experiment_id[dmSIGINT]]
	{
		@data_rate *= #$@DMOS_EXPERIMENT_VALUES/SIGINT/LargeVariantMultiplier$
		@ec_rate *= #$@DMOS_EXPERIMENT_VALUES/SIGINT/LargeVariantMultiplier$
	}
}

@PART[dmRoverGoo]:NEEDS[DMagicOrbitalScience,FeatureScience]:AFTER[Kerbalism]
{
	@MODULE[Experiment]:HAS:HAS[#experiment_id[mysteryGoo]]
	{
		@data_rate /= #$@DMOS_EXPERIMENT_VALUES/MISC/MicroGoo/durationMultiplier$
		@UPGRADES
		{
			@UPGRADE[Goo-Storage-Upgrade]
			{
				%sample_reservoir = #$../../#sample_reservoir$
				@sample_reservoir *= #$../../../@DMOS_EXPERIMENT_VALUES/MISC/MicroGoo/SampleReservoirUpgrade$
			}
		}
	}
}

@PART[dmRoverMat]:NEEDS[DMagicOrbitalScience,FeatureScience]:AFTER[Kerbalism]
{
	@MODULE[Experiment]:HAS:HAS[#experiment_id[mobileMaterialsLab]]
	{
		@data_rate /= #$@DMOS_EXPERIMENT_VALUES/MISC/MicroMatBay/durationMultiplier$
		@UPGRADES
		{
			@UPGRADE[Goo-Storage-Upgrade]
			{
				%sample_reservoir = #$../../#sample_reservoir$
				@sample_reservoir *= #$../../../@DMOS_EXPERIMENT_VALUES/MISC/MicroMatBay/SampleReservoirUpgrade$
			}
		}
	}
}
// =========================================================
// Adding relevant experiments to relevant groups.
// =========================================================

// some SETUPs/Experiments are commented out. They make little sense to be on the orbital scanner
// such as the SIGINT, Orbital Telescope, etc due to ingame model. But the option is there.
// If you want them enabled, remove the comments on the relevant MODULE AND SETUP.

@PART[*]:HAS[@MODULE[Configure]:HAS[#title[Orbital?Scanner]]]:NEEDS[DMagicOrbitalScience,FeatureScience]:FOR[Kerbalism]
{	
	MODULE
	{
		name = Experiment
		experiment_id = magScan
	}
	
	MODULE
	{
		name = Experiment
		experiment_id = rpwsScan
	}
	
	// MODULE
	// {
		// name = Experiment
		// experiment_id = scopeScan
	// }
	
	MODULE
	{
		name = Experiment
		experiment_id = dmImagingPlatform
	}
	
	// MODULE
	// {
		// name = Experiment
		// experiment_id = dmSIGINT
	// }
	
	// MODULE
	// {
		// name = Experiment
		// experiment_id = dmReconScan
	// }
	
	MODULE
	{
		name = Experiment
		experiment_id = dmSolarParticles
	}
	
	MODULE
	{
		name = Experiment
		experiment_id = dmSoilMoisture
	}
	
	MODULE
	{
		name = Experiment
		experiment_id = dmAsteroidScan
	}
	
	MODULE
	{
		name = Experiment
		experiment_id = dmRadiometerScan
	}
	
	MODULE
	{
		name = Experiment
		experiment_id = AnomalyScan
	}
	
	@MODULE[Configure]:HAS[#title[Orbital?Scanner]]
	{
		SETUP
		{
			name = Magnetometer 
			desc = Adds a Magnetometer to the Orbital Scanner
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = magScan
			}
		}
		
		SETUP
		{
			name = RPWS Antenna
			desc = Adds a RPWS Antenna to the Orbital Scanner
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = rpwsScan
			}
		}
		
		// SETUP
		// {
			// name = Orbital Telescope
			// desc = Adds a Orbital Telescope to the Orbital Scanner
			// MODULE
			// {
				// type = Experiment
				// id_field = experiment_id
				// id_value = scopeScan
			// }
		// }
		
		SETUP
		{
			name = Multi-Spectral Imaging Platform
			desc = Adds a Multi-Spectral Imaging Platform to the Orbital Scanner
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = dmImagingPlatform
			}
		}
		
		// SETUP
		// {
			// name = Signals Intelligence Sensor
			// desc = Adds a Signals Intelligence Sensor to the Orbital Scanner
			// MODULE
			// {
				// type = Experiment
				// id_field = experiment_id
				// id_value = dmSIGINT
			// }
		// }
		
		// SETUP
		// {
			// name = Surveillance Camera
			// desc = Adds a Surveillance Camera to the Orbital Scanner
			// MODULE
			// {
				// type = Experiment
				// id_field = experiment_id
				// id_value = dmReconScan
			// }
		// }
		
		SETUP
		{
			name = Solar Particle Collector
			desc = Adds a Solar Particle Collector to the Orbital Scanner
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = dmSolarParticles
			}
		}
		
		SETUP
		{
			name = Soil Moisture Sensor
			desc = Adds a Soil Moisture Sensor to the Orbital Scanner
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = dmSoilMoisture
			}
		}
		
		SETUP
		{
			name = Asteroid Sounding Experiment by Radiowave Transmission
			desc = Adds the Asteroid Sounding Experiment by Radiowave Transmission to the Orbital Scanner
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = dmAsteroidScan
			}
		}
		
		SETUP
		{
			name = GORESat
			desc = Adds the GORESat to the Orbital Scanner
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = dmRadiometerScan
			}
		}
		
		SETUP
		{
			name = Anomalous Signal Sensor
			desc = Adds a Anomalous Signal Sensor to the Orbital Scanner
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = AnomalyScan
			}
		}
	}
}

// ============================================================================
// Patching the SETUPs inside the Configure Module.
// ============================================================================

@PART[*]:HAS[@MODULE[Configure]:HAS[#title[Orbital?Scanner]]]:NEEDS[DMagicOrbitalScience,FeatureScience]:FOR[Kerbalism]
{
	@MODULE[Configure]:HAS[#title[Orbital?Scanner]]
	{
		@SETUP:HAS[#name[Magnetometer]]
		{
			%tech = #$../../@DMOS_EXPERIMENT_VALUES/MagnetometerScan/UnlockTech$
			%mass = #$../../@DMOS_EXPERIMENT_VALUES/MagnetometerScan/SetupMass$
			%cost = #$../../@DMOS_EXPERIMENT_VALUES/MagnetometerScan/SetupCost$
		}
		
		@SETUP:HAS[#name[RPWS?Antenna]]
		{
			%tech = #$../../@DMOS_EXPERIMENT_VALUES/RPWS/UnlockTech$
			%mass = #$../../@DMOS_EXPERIMENT_VALUES/RPWS/SetupMass$
			%cost = #$../../@DMOS_EXPERIMENT_VALUES/RPWS/SetupCost$
		}
		
		@SETUP:HAS[#name[Orbital?Telescope]]
		{
			%tech = #$../../@DMOS_EXPERIMENT_VALUES/OrbitalTelescope/UnlockTech$
			%mass = #$../../@DMOS_EXPERIMENT_VALUES/OrbitalTelescope/SetupMass$
			%cost = #$../../@DMOS_EXPERIMENT_VALUES/OrbitalTelescope/SetupCost$
		}
		
		@SETUP:HAS[#name[Multi?Spectral?Imaging?Platform]]
		{
			%tech = #$../../@DMOS_EXPERIMENT_VALUES/MultiSpectralAnalysis/UnlockTech$
			%mass = #$../../@DMOS_EXPERIMENT_VALUES/MultiSpectralAnalysis/SetupMass$
			%cost = #$../../@DMOS_EXPERIMENT_VALUES/MultiSpectralAnalysis/SetupCost$
		}
		
		@SETUP:HAS[#name[Signals?Intelligence?Sensor]]
		{
			%tech = #$../../@DMOS_EXPERIMENT_VALUES/SIGINT/UnlockTech$
			%mass = #$../../@DMOS_EXPERIMENT_VALUES/SIGINT/SetupMass$
			%cost = #$../../@DMOS_EXPERIMENT_VALUES/SIGINT/SetupCost$
		}
		
		@SETUP:HAS[#name[Surveillance?Camera]]
		{
			%tech = #$../../@DMOS_EXPERIMENT_VALUES/RECON/UnlockTech$
			%mass = #$../../@DMOS_EXPERIMENT_VALUES/RECON/SetupMass$
			%cost = #$../../@DMOS_EXPERIMENT_VALUES/RECON/SetupCost$
		}
		
		@SETUP:HAS[#name[Solar?Particle?Collector]]
		{
			%tech = #$../../@DMOS_EXPERIMENT_VALUES/SOLARPARTICLES/UnlockTech$
			%mass = #$../../@DMOS_EXPERIMENT_VALUES/SOLARPARTICLES/SetupMass$
			%cost = #$../../@DMOS_EXPERIMENT_VALUES/SOLARPARTICLES/SetupCost$
		}
		
		@SETUP:HAS[#name[Soil?Moisture?Sensor]]
		{
			%tech = #$../../@DMOS_EXPERIMENT_VALUES/SoilMoisture/UnlockTech$
			%mass = #$../../@DMOS_EXPERIMENT_VALUES/SoilMoisture/SetupMass$
			%cost = #$../../@DMOS_EXPERIMENT_VALUES/SoilMoisture/SetupCost$
		}
		
		@SETUP:HAS[#name[Asteroid?Sounding?Experiment?by?Radiowave?Transmission]]
		{
			%tech = #$../../@DMOS_EXPERIMENT_VALUES/AsteroidScan/UnlockTech$
			%mass = #$../../@DMOS_EXPERIMENT_VALUES/AsteroidScan/SetupMass$
			%cost = #$../../@DMOS_EXPERIMENT_VALUES/AsteroidScan/SetupCost$
		}

		@SETUP:HAS[#name[GORESat]]
		{
			%tech = #$../../@DMOS_EXPERIMENT_VALUES/GORESAT/UnlockTech$
			%mass = #$../../@DMOS_EXPERIMENT_VALUES/GORESAT/SetupMass$
			%cost = #$../../@DMOS_EXPERIMENT_VALUES/GORESAT/SetupCost$
		}

		@SETUP:HAS[#name[Anomalous?Signal?Sensor]]
		{
			%tech = #$../../@DMOS_EXPERIMENT_VALUES/AnomalyScan/UnlockTech$
			%mass = #$../../@DMOS_EXPERIMENT_VALUES/AnomalyScan/SetupMass$
			%cost = #$../../@DMOS_EXPERIMENT_VALUES/AnomalyScan/SetupCost$
		}
	}
}

// ============================================================================
// Due to the large number of experiments added by DMOS, I'm boosting the slots
// (both base and upgraded) by 1. Small QoL.
// ============================================================================

@PART[*]:HAS[@MODULE[Configure]:HAS[#title[Orbital?Scanner]]]:NEEDS[DMagicOrbitalScience,FeatureScience]:AFTER[Kerbalism]
{
	@MODULE[Configure]:HAS[#title[Orbital?Scanner]]
	{
		@slots += 1
		@UPGRADES
		{
			@UPGRADE[Orbital-Upgrade1]
			{
				@slots += 1
			}
		}
	}
}
