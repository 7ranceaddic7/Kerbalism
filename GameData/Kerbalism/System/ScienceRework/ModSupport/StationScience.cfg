// in the default state, station science is extremely overpowered for kerbalism
// Nerfed in a fairly harsh manner. Increased the costs, durations, removed biomes
// and restricted them to kerbin low orbit only. Also reduced the science value

STATIONSCIENCE_EXPERIMENT_VALUES:NEEDS[StationScience,FeatureScience]
{
	progradeKuarqs
	{
		ECCost = 16.82							
		size = 25486
		value = 40								
		duration = 3888000							//180 days
		requirements = Body:Kerbin,Space
		ResourceRates = Kuarqs@1.4
	}
	
	retrogradeKuarqs
	{
		ECCost = 18.45							
		size = 35148
		value = 45								
		duration = 5184000							//240 days
		requirements = Body:Kerbin,Space
		ResourceRates = Eurekas@0.00027777777,Kuarqs@2.1
	}
	
	eccentricKuarqs
	{
		ECCost = 24.06							
		size = 31584
		value = 55								
		duration = 7776000							//360 days					
		requirements = Body:Kerbin,Space
		ResourceRates = Eurekas@0.00027777777,Kuarqs@1.8
	}
	
	bioproducts
	{
		ECCost = 27.82							
		size = 18956
		value = 50								
		duration = 6480000							//300 days							
		requirements = Body:Kerbin,Space
		ResourceRates = Eurekas@0.00027777777
	}
	
	kuarqsBioproducts
	{
		ECCost = 33.08							
		size = 42087
		value = 65								
		duration = 10000800							// 1 year (463 days)							
		requirements = Body:Kerbin,Space
		ResourceRates = Eurekas@0.00027777777,Kuarqs@1.2,Bioproducts@0.00027777777
	}
}
// Contract Tweaks (removing impossible contracts)

@STN_SCI_SETTINGS:NEEDS[StationScience,FeatureScience]
{
	@experimentChallenge
	{
		!StnSciExperiment1 = del
	}
	
	@planetChallenge
	{
		!* = del
		Kerbin = 1
	}
	
	@experimentPrereqs
	{
		!StnSciExperiment1 = del
	}
}

// removing the plant growth experiment. Kerbalism already has one, with more complex requirements.
// No point in having 2 identical plant growths just because. The part is also gone.
!PART[StnSciExperiment1]:NEEDS[StationScience,FeatureScience]							{}
!EXPERIMENT_DEFINITION:HAS[#id[plantGrowth]]:NEEDS[StationScience,FeatureScience]		{}

// the Spectrometron's functionality cannot be replicated. Experiments work without it, so RIP.
!PART[StnSciSpectro]:NEEDS[StationScience,FeatureScience]								{}

//replacing the experiment modules with our own.
@PART[StnSciExperiment*]:NEEDS[StationScience,FeatureScience]
{
	MODULE
	{
		name = Experiment
		experiment_id = #$/MODULE[StationExperiment]/experimentID$
	}
	
	!MODULE[StationExperiment]		{}
}

// due to experiment reconfiguation, the experiment parts do not have the ability to store resources anymore.
// adding small tanks to the parts generating them instead.
// boosting the HDD Capacity for the labs as well. these experiments are large.
@PART[StnSciZoo]:NEEDS[StationScience,FeatureScience]:AFTER[Kerbalism]
{
	RESOURCE
	{
		name = Bioproducts
		amount = 0
		maxAmount = 50
	}
	
	@MODULE[HardDrive]
	{
		@dataCapacity = 256
		@sampleCapacity = 0
	}
}

@PART[StnSciLab]:NEEDS[StationScience,FeatureScience]:AFTER[Kerbalism]
{
	RESOURCE
	{
		name = Eurekas
		amount = 0
		maxAmount = 50
	}
	
	@MODULE[HardDrive]
	{
		@dataCapacity = 256
		@sampleCapacity = 0
	}
}

@PART[StnSciCyclo]:NEEDS[StationScience,FeatureScience]:AFTER[Kerbalism]
{
	RESOURCE
	{
		name = Kuarqs
		amount = 0
		maxAmount = 720
	}
}
//Patching the experiments with calculated values from the tweakables.
@PART[StnSciExperiment*]:NEEDS[StationScience,FeatureScience]:AFTER[Kerbalism]
{
	@MODULE[Experiment]:HAS[#experiment_id[progradeKuarqs]]
	{
		%ec_rate = #$@STATIONSCIENCE_EXPERIMENT_VALUES/progradeKuarqs/ECCost$
		%requires = #$@STATIONSCIENCE_EXPERIMENT_VALUES/progradeKuarqs/requirements$
		%data_rate = #$@STATIONSCIENCE_EXPERIMENT_VALUES/progradeKuarqs/size$
		@data_rate /= #$@STATIONSCIENCE_EXPERIMENT_VALUES/progradeKuarqs/duration$
		%resources = #$@STATIONSCIENCE_EXPERIMENT_VALUES/progradeKuarqs/ResourceRates$
	}
	
	@MODULE[Experiment]:HAS[#experiment_id[retrogradeKuarqs]]
	{
		%ec_rate = #$@STATIONSCIENCE_EXPERIMENT_VALUES/retrogradeKuarqs/ECCost$
		%requires = #$@STATIONSCIENCE_EXPERIMENT_VALUES/retrogradeKuarqs/requirements$
		%data_rate = #$@STATIONSCIENCE_EXPERIMENT_VALUES/retrogradeKuarqs/size$
		@data_rate /= #$@STATIONSCIENCE_EXPERIMENT_VALUES/retrogradeKuarqs/duration$
		%resources = #$@STATIONSCIENCE_EXPERIMENT_VALUES/retrogradeKuarqs/ResourceRates$
	}
	
	@MODULE[Experiment]:HAS[#experiment_id[eccentricKuarqs]]
	{
		%ec_rate = #$@STATIONSCIENCE_EXPERIMENT_VALUES/eccentricKuarqs/ECCost$
		%requires = #$@STATIONSCIENCE_EXPERIMENT_VALUES/eccentricKuarqs/requirements$
		%data_rate = #$@STATIONSCIENCE_EXPERIMENT_VALUES/eccentricKuarqs/size$
		@data_rate /= #$@STATIONSCIENCE_EXPERIMENT_VALUES/eccentricKuarqs/duration$
		%resources = #$@STATIONSCIENCE_EXPERIMENT_VALUES/eccentricKuarqs/ResourceRates$
	}
	
	@MODULE[Experiment]:HAS[#experiment_id[bioproducts]]
	{
		%ec_rate = #$@STATIONSCIENCE_EXPERIMENT_VALUES/bioproducts/ECCost$
		%requires = #$@STATIONSCIENCE_EXPERIMENT_VALUES/bioproducts/requirements$
		%data_rate = #$@STATIONSCIENCE_EXPERIMENT_VALUES/bioproducts/size$
		@data_rate /= #$@STATIONSCIENCE_EXPERIMENT_VALUES/bioproducts/duration$
		%resources = #$@STATIONSCIENCE_EXPERIMENT_VALUES/bioproducts/ResourceRates$
	}
	
	@MODULE[Experiment]:HAS[#experiment_id[kuarqsBioproducts]]
	{
		%ec_rate = #$@STATIONSCIENCE_EXPERIMENT_VALUES/kuarqsBioproducts/ECCost$
		%requires = #$@STATIONSCIENCE_EXPERIMENT_VALUES/kuarqsBioproducts/requirements$
		%data_rate = #$@STATIONSCIENCE_EXPERIMENT_VALUES/kuarqsBioproducts/size$
		@data_rate /= #$@STATIONSCIENCE_EXPERIMENT_VALUES/kuarqsBioproducts/duration$
		%resources = #$@STATIONSCIENCE_EXPERIMENT_VALUES/kuarqsBioproducts/ResourceRates$
	}
}

// =========================================================
// Pathing the definitions, replacing value and size with the ones specified above.
// =========================================================
@EXPERIMENT_DEFINITION:HAS[#id[progradeKuarqs]]:NEEDS[StationScience,FeatureScience]:AFTER[Kerbalism]
{
	@baseValue = #$@STATIONSCIENCE_EXPERIMENT_VALUES/progradeKuarqs/value$
	@dataScale = #$@STATIONSCIENCE_EXPERIMENT_VALUES/progradeKuarqs/size$
	@dataScale /= #$baseValue$
	@situationMask = 16
	@biomeMask = 0
}

@EXPERIMENT_DEFINITION:HAS[#id[retrogradeKuarqs]]:NEEDS[StationScience,FeatureScience]:AFTER[Kerbalism]
{
	@baseValue = #$@STATIONSCIENCE_EXPERIMENT_VALUES/retrogradeKuarqs/value$
	@dataScale = #$@STATIONSCIENCE_EXPERIMENT_VALUES/retrogradeKuarqs/size$
	@dataScale /= #$baseValue$
	@situationMask = 16
	@biomeMask = 0
}

@EXPERIMENT_DEFINITION:HAS[#id[eccentricKuarqs]]:NEEDS[StationScience,FeatureScience]:AFTER[Kerbalism]
{
	@baseValue = #$@STATIONSCIENCE_EXPERIMENT_VALUES/eccentricKuarqs/value$
	@dataScale = #$@STATIONSCIENCE_EXPERIMENT_VALUES/eccentricKuarqs/size$
	@dataScale /= #$baseValue$
	@situationMask = 16
	@biomeMask = 0
}

@EXPERIMENT_DEFINITION:HAS[#id[bioproducts]]:NEEDS[StationScience,FeatureScience]:AFTER[Kerbalism]
{
	@baseValue = #$@STATIONSCIENCE_EXPERIMENT_VALUES/bioproducts/value$
	@dataScale = #$@STATIONSCIENCE_EXPERIMENT_VALUES/bioproducts/size$
	@dataScale /= #$baseValue$
	@situationMask = 16
	@biomeMask = 0
}

@EXPERIMENT_DEFINITION:HAS[#id[kuarqsBioproducts]]:NEEDS[StationScience,FeatureScience]:AFTER[Kerbalism]
{
	@baseValue = #$@STATIONSCIENCE_EXPERIMENT_VALUES/kuarqsBioproducts/value$
	@dataScale = #$@STATIONSCIENCE_EXPERIMENT_VALUES/kuarqsBioproducts/size$
	@dataScale /= #$baseValue$
	@situationMask = 16
	@biomeMask = 0
}